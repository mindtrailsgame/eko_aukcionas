<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tvarumo Aukcionas</title>
    <style>
        :root {
            --primary-color: #2c6e49;
            --secondary-color: #fefee3;
            --accent-color: #ffc94b;
            --danger-color: #d9534f;
            --light-bg: #f9f9f9;
            --info-color: #4a90e2;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--light-bg);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .phone-wrapper {
            width: 100%;
            max-width: 400px;
            height: 100vh;
            max-height: 800px;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .screen { display: none; flex-direction: column; height: 100%; padding: 20px; box-sizing: border-box; text-align: center; }
        .screen.active { display: flex; }
        #start-screen { justify-content: center; gap: 20px; }
        #start-screen h1 { font-size: 2.5em; color: var(--primary-color); }
        #start-screen p { font-size: 1.1em; line-height: 1.5; }
        #game-screen { padding: 0; }
        .game-header { background-color: var(--primary-color); color: white; padding: 15px 20px; border-bottom: 4px solid var(--accent-color); }
        .game-header h2 { margin: 0; font-size: 1.2em; }
        .score-display { font-size: 2em; font-weight: bold; margin-top: 5px; transition: color 0.3s; }
        .day-nav { display: flex; justify-content: space-around; padding: 10px 0; background-color: #f0f0f0; }
        .day-btn { background: none; border: 2px solid transparent; padding: 8px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .day-btn.active { border-color: var(--primary-color); background-color: var(--secondary-color); }
        .plan-area { flex-grow: 1; padding: 20px; overflow-y: auto; text-align: left; }
        .plan-slot { background-color: #fff; border: 1px dashed #ccc; border-radius: 8px; margin-bottom: 15px; padding: 15px; }
        .plan-slot h3, .plan-area h2 { margin: 0 0 10px 0; color: var(--primary-color); }
        .slot-content { min-height: 24px; }
        .add-btn { background: none; border: none; color: var(--primary-color); font-weight: bold; font-size: 1em; cursor: pointer; }
        .action-buttons-container { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }
        .action-btn { background-color: var(--secondary-color); color: var(--primary-color); border: 1px solid var(--primary-color); padding: 10px; border-radius: 8px; text-align: center; cursor: pointer; font-weight: bold; }
        #end-screen {
            justify-content: flex-start; /* Pradeda turinƒØ nuo vir≈°aus */
            gap: 20px;
            overflow-y: auto; /* Prideda scroll, jei reikia */
        }
        .btn { padding: 15px 25px; font-size: 1.2em; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .btn-primary { background-color: var(--accent-color); color: var(--primary-color); }
        .btn-secondary { background-color: #eee; color: #555; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background-color: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 380px; max-height: 80%; overflow-y: auto; }
        .modal-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; gap: 10px; }
        .modal-item:hover { background-color: var(--secondary-color); }
        .item-name { flex-grow: 1; }
        .item-points { font-weight: bold; white-space: nowrap; }
        .item-info-icon { font-weight: bold; color: var(--info-color); cursor: help; border-radius: 50%; width: 20px; height: 20px; display: inline-flex; justify-content: center; align-items: center; border: 1px solid var(--info-color); }
        .general-actions-list { list-style-type: none; padding: 0; margin-top: 10px; }
        .general-actions-list li { background: #f0f0f0; padding: 5px 10px; border-radius: 5px; font-size: 0.9em; margin-bottom: 5px; }
        .btn.disabled {
            background-color: #ccc;
            color: #888;
            cursor: not-allowed;
            border-color: #ccc;
        }
    </style>
</head>
<body>
    <div class="phone-wrapper">
        <div id="start-screen" class="screen active">
            <h1>Tvarumo Aukcionas üåç</h1>
            <p>Suplanuokite savaitƒô, nevir≈°ydami 100 eko-ta≈°k≈≥ biud≈æeto. Sƒókmƒós!</p>
            <button id="start-btn" class="btn btn-primary">Pradƒóti ≈æaidimƒÖ</button>
            <button id="rules-btn" class="btn btn-secondary">Kaip ≈æaisti?</button>
        </div>
        <div id="game-screen" class="screen">
            <header class="game-header">
                <h2>Likutis:</h2>
                <div id="score" class="score-display">100/100 t≈°k.</div>
            </header>
            <nav class="day-nav" id="day-nav"></nav>
            <main class="plan-area" id="plan-area"></main>
            <button id="finish-btn" class="btn btn-primary" style="margin: 20px; border-radius: 8px;">Baigti planavimƒÖ</button>
        </div>
        <div id="end-screen" class="screen">
            <h2 id="end-title">Rezultatas</h2>
            <p id="end-message" style="font-size: 1.2em;"></p>
            <button id="restart-btn" class="btn btn-primary">≈Ωaisti i≈° naujo</button>
        </div>
    </div>
    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Pasirinkite veiksmƒÖ</h3>
            <div id="modal-list"></div>
            <div id="modal-footer" style="margin-top: 20px; display: flex; justify-content: space-between;">
                <button id="modal-close-btn" class="btn btn-secondary">U≈ædaryti</button>
                <button id="modal-confirm-btn" class="btn btn-primary" style="display: none;">Patvirtinti</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA FROM PDF (UPDATED) ---
        const items = {
            'Maistas': [
                { name: 'Jautienos kepsnys ar mƒósainis', points: -15, reality: 'Viena 200 g porcija jautienos ‚Äûkainuoja‚Äú apie 12-20 kg CO2e. Tai prilygsta ma≈ædaug 100 km kelionei automobiliu.' },
                { name: 'Pica su s≈´riu ar patiekalas su daug s≈´rio', points: -10, reality: 'S≈´rio gamyba yra antras did≈æiausias maisto pramonƒós ter≈°ƒójas po jautienos. 1 kg s≈´rio apie 10-20 kg CO2e.' },
                { name: 'Patiekalas su vi≈°tiena / kiauliena', points: -8, reality: '1 kg vi≈°tienos - apie 6 kg CO2e. ≈Ωymiai ma≈æiau nei jautienos, bet vis tiek reik≈°mingai daugiau nei augalinio maisto.' },
                { name: 'Patiekalas su ≈æuvimi (pvz., la≈°i≈°a i≈° fermos)', points: -6, reality: 'Priklauso nuo ≈æuvies, bet 1 kg la≈°i≈°os i≈° fermos gamyba gali siekti apie 11 kg CO2e.' },
                { name: 'Patiekalas su importuotais augaliniais produktais', points: -4, reality: 'Nors poveikis ma≈æesnis, tolimas transportavimas ir didelis vandens suvartojimas (pvz., 1 kg avokad≈≥ gali prireikti iki 2000 litr≈≥ vandens) palieka pƒódsakƒÖ.' },
                { name: 'Sumu≈°tiniai su dar≈æovƒómis (+ priedas)', points: -3, reality: 'Apie 0.3 kg CO2e. Priedai su gyv≈´ninƒós kilmƒós produktais ≈æenkliai padidina pƒódsakƒÖ.' },
                { name: 'Vietinƒó ko≈°ƒó ar vietini≈≥ dar≈æovi≈≥ sriuba/tro≈°kinys', points: -2, reality: 'Poveikis minimalus. 1 kg lƒô≈°i≈≥ - ma≈æiau nei 1 kg CO2e.' },
            ],
            'Gƒórimai': [
                { name: 'Kava vienkartiniame puodelyje', points: -2, reality: 'Pats popierinis puodelis su plastikiniu dangteliu turi apie 0.1 kg CO‚ÇÇe pƒódsakƒÖ. Per metus tai gali susidaryti ƒØ reik≈°mingƒÖ kiekƒØ.' },
                { name: 'Energinis gƒórimas / gƒórimas skardinƒóje', points: -4, reality: 'Apie 0.3-0.5 kg CO2e. Did≈æiausiƒÖ poveikƒØ daro aliuminio skardinƒós gamyba, kuri yra itin imli energijai.' },
            ],
            'Transportas': [
                { name: 'Kelionƒó automobiliu (vienam/dviese)', points: -14, reality: 'Vidutinis benzininis automobilis i≈°meta apie 170 g CO2/km. 40 km kelionƒó pirmyn ir atgal - apie 6.8 kg CO2e.' },
                { name: 'Kelionƒó vie≈°uoju transportu', points: -4, reality: 'Poveikis i≈°sidalina visiems keleiviams. Vienam ≈æmogui tenkanti emisija 40 km kelionei yra apie 1.6 kg CO‚ÇÇe.' },
                { name: 'Kelionƒó dviraƒçiu, paspirtuku ar pƒósƒçiomis', points: 2, reality: 'Poveikis aplinkai - prakti≈°kai 0.' },
            ],
            'U≈ækand≈æiai ir gƒórimai': [
                { name: '‚ÄûPringles" tra≈°kuƒçi≈≥ t≈´telƒó', points: -6, reality: 'Realybƒó: ~0.7 kg CO‚ÇÇe. ≈†is produktas yra ‚Äûekologinis ko≈°maras‚Äú dƒól pakuotƒós. T≈´telƒó pagaminta i≈° keli≈≥ med≈æiag≈≥ (kartono, metalo, plastikinio dangtelio), todƒól jos prakti≈°kai neƒØmanoma perdirbti.' },
                { name: '‚ÄûEstrella" ar ‚ÄûOho!" tra≈°kuƒçi≈≥ pakelis', points: -5, reality: 'Realybƒó: ~0.4-0.6 kg CO‚ÇÇe. Nors paƒçi≈≥ tra≈°kuƒçi≈≥ pƒódsakas pana≈°us, pakuotƒó yra ≈°iek tiek ma≈æesnis blogis nei ‚ÄûPringles‚Äú, taƒçiau vis tiek pagaminta i≈° daugiasluoksnio, sunkiai perdirbamo plastiko ir aliuminio folijos.' },
                { name: '‚ÄûMagija" glaistytas s≈´relis', points: -4, reality: 'Realybƒó: ~0.3-0.5 kg CO‚ÇÇe. Pieno produkt≈≥ gamyba (var≈°kƒó, sviestas) yra imli resursams. Taip pat prisideda neperdirbama daugiasluoksnƒó pakuotƒó.' },
                { name: '≈†okoladukas ‚ÄûKar≈´na"', points: -4, reality: 'Realybƒó: Poveikis labai priklauso nuo ingredient≈≥. Pieno milteliai, palmi≈≥ aliejus (da≈ænai susijƒôs su mi≈°k≈≥ kirtimu) ir netvariai auginama kakava sudaro did≈æiƒÖjƒÖ dalƒØ pƒódsako.' },
                { name: '‚ÄûCoca-Cola" gƒórimas (0.5 l plastikiniame butelyje)', points: -3, reality: 'Realybƒó: ~0.2-0.3 kg CO‚ÇÇe. Plastikinis (PET) butelis gaminamas i≈° naftos. Prie pƒódsako prisideda ne tik butelio gamyba, bet ir cukraus gamyba, transportavimas.' },
                { name: '‚ÄûCoca-Cola" gƒórimas (0.33 l skardinƒóje)', points: -4, reality: 'Realybƒó: ~0.3-0.5 kg CO‚ÇÇe. Aliuminio gamyba yra itin imli energijai, todƒól skardinƒó palieka didesnƒØ pƒódsakƒÖ nei plastikinis butelis.' },
                { name: '‚ÄûSmetoni≈°ka" gira (1 l plastikiniame butelyje)', points: -2, reality: 'Realybƒó: ~0.3 kg CO‚ÇÇe (u≈æ visƒÖ butelƒØ). Gira da≈ænai yra lokalesnis produktas, reikalaujantis ma≈æiau sudƒóting≈≥, importuojam≈≥ ingredient≈≥ ir trumpesnio transportavimo kelio.' },
                { name: '‚ÄûNept≈´no" vanduo (0.5 l plastikiniame butelyje)', points: -3, reality: 'Realybƒó: ~0.15 kg CO‚ÇÇe. VisƒÖ ≈æalƒÖ daro plastikinƒó pakuotƒó ir transportavimas, ypaƒç kai Lietuvoje turime auk≈°tos kokybƒós vandenƒØ i≈° ƒçiaupo.' },
                { name: 'Lietuvi≈°kas obuolys ar morka (be pakuotƒós)', points: 0, reality: 'Realybƒó: Poveikis artimas nuliui. Vietinis, sezoninis produktas be jokios pakuotƒós. Pats tvariausias pasirinkimas.' },
                { name: 'Vanduo i≈° ƒçiaupo (ƒØ savo gertuvƒô)', points: 1, reality: 'Realybƒó: Poveikis prakti≈°kai nulinis. Gertuvƒós naudojimas padeda i≈°vengti ≈°imt≈≥ plastikini≈≥ buteli≈≥ per metus.' }
            ],
            'Pirkiniai ir pramogos': [
                { name: 'Skrydis lƒóktuvu savaitgalio i≈°vykai', points: -80, reality: 'Toks skrydis ƒØ abi puses vienam asmeniui i≈°meta apie 250-300 kg CO2e. Tai daugiau, nei tvarus metinis CO2 biud≈æetas leid≈æia transportui.', isWeekly: true },
                { name: 'Naujas i≈°manusis telefonas', points: -75, reality: 'Apie 80% telefono CO2 pƒódsako atsiranda gamybos metu. Tai sudaro apie 60-90 kg CO2e, neƒØskaitant ret≈≥j≈≥ metal≈≥ kasybos poveikio.'},
                { name: 'Naujas greitosios mados drabu≈æis (pvz., d≈æinsai)', points: -30, reality: 'Viena pora d≈æins≈≥ ‚Äì apie 33 kg CO2e ir ~3,700 litr≈≥ vandens. Tai prilygsta 111 km kelionei automobiliu ir 3 met≈≥ geriamojo vandens kiekiui vienam ≈æmogui.'},
                { name: 'Drabu≈æis ar daiktas i≈° antr≈≥ rank≈≥ parduotuvƒós', points: -3, reality: 'Poveikis artimas nuliui, nesukuriama nauja paklausa gamybai. PƒódsakƒÖ sudaro tik transportavimas iki parduotuvƒós.'},
                { name: 'Apsilankymas kine', points: -5, reality: 'Poveikis nedidelis, daugiausia susijƒôs su pastato energijos vartojimu.'},
                { name: 'Pasivaik≈°ƒçiojimas parke / ≈æygis mi≈°ke', points: 3, reality: 'Skatina ry≈°ƒØ su gamta, jos vertinimƒÖ ir i≈°saugojimƒÖ.'},
                { name: 'Skaitmeninƒós knygos skaitymas (e. knyga)', points: -2, reality: 'Pats skaitymo ir atsisiuntimo procesas yra labai taupus (~20-50 g CO‚ÇÇe). Palyginimui, naujos popierinƒós knygos pƒódsakas - apie 1-3 kg CO2e. Taƒçiau didysis ‚Äûbet" yra skaitymo ƒØrenginio (skaityklƒós, plan≈°etƒós) gamyba, kuri siekia ~30-50 kg CO2e. Vadinasi, kad skaityklƒó atsipirkt≈≥ ekologi≈°kai, ja reikia perskaityti de≈°imtis knyg≈≥, kurias antraip b≈´tumƒóte pirkƒô popierines. Pats tvariausias pasirinkimas - skaityti knygas i≈° bibliotekos!'},
                { name: 'Nauja knyga (popierinƒó)', points: -6, reality: 'Vidutinƒó knyga palieka apie 1-3 kg CO‚ÇÇe pƒódsakƒÖ dƒól popieriaus gamybos, spausdinimo ir transportavimo.'},
            ],
            'Skaitmeninis pasaulis ir buitis': [
                { name: 'Video ≈æaidimai galingu kompiuteriu (u≈æ dienƒÖ)', points: -4, reality: 'Galingas ≈æaidim≈≥ kompiuteris gali vartoti tiek pat energijos, kiek keli ≈°aldytuvai. Kelios valandos ≈æaidimo - apie 0.5-1 kg CO‚ÇÇe.'},
                { name: 'Dirbtinio intelekto (ChatGPT) aktyvus naudojimas (u≈æ dienƒÖ)', points: -3, reality: 'Nors viena u≈æklausa palieka ma≈æƒÖ pƒódsakƒÖ, intensyvus naudojimas per valandƒÖ gali sugeneruoti apie 0.5-7.5 g CO2e dƒól duomen≈≥ centr≈≥ energijos.'},
                { name: 'Nar≈°ymas socialiniuose tinkluose (1-2 val. per dienƒÖ)', points: -2, reality: 'Valanda nar≈°ymo sugeneruoja apie 60-120 g CO2e. ‚ÄûDebesis‚Äú (cloud) i≈° ties≈≥ yra did≈æiuliai, fizi≈°kai egzistuojantys ir daug energijos reikalaujantys pastatai.'},
                { name: 'I≈°maniojo telefono ƒØkrovimas (u≈æ visƒÖ savaitƒô)', points: -1, reality: 'Pats ƒØkrovimas yra menkas (5-10 g CO‚ÇÇe), bet tai priminimas apie did≈æiausiƒÖ telefono poveikƒØ - gamybƒÖ (60-90 kg CO‚ÇÇ–µ).', isWeekly: true },
                { name: 'Skalbimas ir d≈æiovinimas el. d≈æiovyklƒóje (u≈æ 1 ciklƒÖ)', points: -5, reality: 'D≈æiovyklƒó yra vienas daugiausiai energijos vartojanƒçi≈≥ prietais≈≥. Vienas ciklas - apie 1-2 kg CO2e.'},
            ],
            'Pozityv≈´s veiksmai': [
                 { name: 'Savaitƒô nepirkti nieko, kas supakuota ƒØ vienkartinƒØ plastikƒÖ', points: 10, reality: 'Ma≈æinate plastiko tar≈°ƒÖ ir i≈°kastinio kuro vartojimƒÖ, nes plastikas gaminamas i≈° naftos.', isWeekly: true },
                 { name: 'Kruop≈°tus r≈´≈°iavimas visƒÖ savaitƒô', points: 5, reality: 'Perdirbimas taupo energijƒÖ ir gamtos i≈°teklius. Pvz., pagaminti skardinƒô i≈° perdirbto aliuminio reikia 95% ma≈æiau energijos.', isWeekly: true }
            ]
        };

        const STARTING_POINTS = 100;
        const WEEKDAYS = ['P', 'A', 'T', 'K', 'Pn', '≈†', 'S'];
        const DAY_NAMES = ['Pirmadienis', 'Antradienis', 'Treƒçiadienis', 'Ketvirtadienis', 'Penktadienis', '≈†e≈°tadienis', 'Sekmadienis'];

        let currentScore, currentDay, weeklyPlan, chosenWeeklyActions, isWednesdayEventTriggered, isWednesdayEventActive;
        const dom = {
            screens: document.querySelectorAll('.screen'), startBtn: document.getElementById('start-btn'), rulesBtn: document.getElementById('rules-btn'), finishBtn: document.getElementById('finish-btn'), restartBtn: document.getElementById('restart-btn'), scoreDisplay: document.getElementById('score'), dayNav: document.getElementById('day-nav'), planArea: document.getElementById('plan-area'), modal: document.getElementById('modal'), modalTitle: document.getElementById('modal-title'), modalList: document.getElementById('modal-list'), modalCloseBtn: document.getElementById('modal-close-btn'),
            endTitle: document.getElementById('end-title'),
            endMessage: document.getElementById('end-message')
        };

        function showScreen(screenId) { dom.screens.forEach(s => s.classList.toggle('active', s.id === screenId)); }
        
        function initGame() {
            currentScore = STARTING_POINTS; currentDay = 0; chosenWeeklyActions = []; isWednesdayEventTriggered = false; isWednesdayEventActive = false;
            weeklyPlan = Array.from({ length: 7 }, (_, i) => ({
                'Pusryƒçiai': [], 'Piet≈´s': [], 'Vakarienƒó': [],
                'Transportas': [], 
                'Bendri veiksmai': []
            }));
            updateScore(0); renderDayNav(); renderPlanForDay(currentDay); showScreen('game-screen'); updateFinishButtonState();
        }

        function updateScore(points) {
            currentScore += points;
            dom.scoreDisplay.textContent = `${currentScore}/${STARTING_POINTS} t≈°k.`;
            if (currentScore < 0) dom.scoreDisplay.style.color = '#d9534f';
            else if (currentScore < STARTING_POINTS / 2) dom.scoreDisplay.style.color = '#ffc94b';
            else dom.scoreDisplay.style.color = 'white';
        }
        function updateFinishButtonState() {
            let isPlanComplete = true;
            for (let i = 0; i < 7; i++) {
                const dayPlan = weeklyPlan[i];
                const foodItemsCount = dayPlan['Pusryƒçiai'].length + 
                                       dayPlan['Piet≈´s'].length + 
                                       dayPlan['Vakarienƒó'].length;
                if (foodItemsCount < 2) {
                    isPlanComplete = false;
                    break; 
                }
            }
            dom.finishBtn.classList.toggle('disabled', !isPlanComplete);
        }
        function renderDayNav() {
            dom.dayNav.innerHTML = '';
            WEEKDAYS.forEach((day, index) => {
                const btn = document.createElement('button');
                btn.className = 'day-btn'; btn.textContent = day;
                btn.classList.toggle('active', index === currentDay);
                btn.onclick = () => {
                    currentDay = index;
                    if (index === 2 && !isWednesdayEventTriggered) {
                        triggerWednesdayEvent();
                    }
                    renderDayNav();
                    renderPlanForDay(currentDay);
                };
                dom.dayNav.appendChild(btn);
            });
        }
        
        function renderPlanForDay(dayIndex) {
            dom.planArea.innerHTML = '';
            const dayPlan = weeklyPlan[dayIndex];
            const title = document.createElement('h2');
            title.textContent = DAY_NAMES[dayIndex];
            dom.planArea.appendChild(title);
            
            ['Pusryƒçiai', 'Piet≈´s', 'Vakarienƒó', 'Transportas'].forEach(slotName => {
                dom.planArea.appendChild(createPlanSlot(dayIndex, slotName, dayPlan[slotName]));
            });
            
            const actionsList = document.createElement('ul');
            actionsList.className = 'general-actions-list';
            dayPlan['Bendri veiksmai'].forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `${item.name} <strong>(${item.points > 0 ? '+' : ''}${item.points} t≈°k.)</strong> <span class="item-info-icon" onclick='alert(${JSON.stringify(item.name + '\\n\\n' + (item.reality || ''))})'>‚ìò</span>`;
                actionsList.appendChild(li);
            });
            dom.planArea.appendChild(actionsList);
            
            const actionsContainer = document.createElement('div');
            actionsContainer.className = 'action-buttons-container';
            const categories = {
                'U≈ækand≈æiai ir gƒórimai': 'U≈ækand≈æiai ir gƒórimai',
                'Pirkiniai ir pramogos': 'Pirkiniai ir pramogos',
                'Skaitmeninis pasaulis ir buitis': 'Skaitmeninis pasaulis ir buitis',
                'Pozityv≈´s veiksmai': 'Pozityv≈´s veiksmai'
            };
            for (const btnText in categories) {
                const btn = document.createElement('button');
                btn.className = 'action-btn';
                btn.textContent = btnText;
                btn.onclick = () => openCategoryModal(dayIndex, categories[btnText]);
                actionsContainer.appendChild(btn);
            }
            dom.planArea.appendChild(actionsContainer);
            updateFinishButtonState();
        }

        function createPlanSlot(dayIndex, slotName, items) {
            const slotDiv = document.createElement('div');
            slotDiv.className = 'plan-slot';
            slotDiv.innerHTML = `<h3>${slotName}</h3><div class="slot-content"></div>`;
            const contentDiv = slotDiv.querySelector('.slot-content');
            
            if (items.length > 0) {
                const list = document.createElement('ul');
                list.className = 'general-actions-list';
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `${item.name} <strong>(${item.points > 0 ? '+' : ''}${item.points} t≈°k.)</strong> <span class="item-info-icon" onclick='alert(${JSON.stringify(item.name + '\\n\\n' + (item.reality || ''))})'>‚ìò</span>`;
                    list.appendChild(li);
                });
                contentDiv.appendChild(list);
            }

            const addButton = document.createElement('button');
            addButton.className = 'add-btn';
            addButton.textContent = '[+] Pridƒóti';
            addButton.onclick = () => openModalForSlot(dayIndex, slotName);
            contentDiv.appendChild(addButton);
            
            return slotDiv;
        }
        
        function openModalForSlot(dayIndex, slotName) {
            const categories = slotName === 'Transportas' ? ['Transportas'] : ['Maistas', 'Gƒórimai'];
            populateMultiSelectModal(`Pasirinkite (${slotName})`, categories, (selectedItems) => {
                selectedItems.forEach(item => {
                    weeklyPlan[dayIndex][slotName].push(item);
                    updateScore(item.points);
                });
                renderPlanForDay(dayIndex);
                closeModal();
            });
        }
        
        function openCategoryModal(dayIndex, category) {
            populateMultiSelectModal(category, category, (selectedItems) => {
                selectedItems.forEach(item => {
                    if (item.isWeekly) chosenWeeklyActions.push(item.name);
                    weeklyPlan[dayIndex]['Bendri veiksmai'].push(item);
                    updateScore(item.points);
                });
                renderPlanForDay(dayIndex);
                closeModal();
            });
        }

        function populateMultiSelectModal(title, itemCategories, onConfirmCallback) {
            dom.modalTitle.textContent = title;
            dom.modalList.innerHTML = '';

            dom.modal.querySelector('#modal-confirm-btn').style.display = 'inline-block';
            dom.modal.querySelector('#modal-close-btn').style.display = 'inline-block';

            let temporarySelections = [];
            let itemsToShow = (Array.isArray(itemCategories) ? itemCategories.flatMap(cat => items[cat]) : items[itemCategories])
                .filter(item => !item.isWeekly || !chosenWeeklyActions.includes(item.name));

            itemsToShow.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'modal-item';
                // Kuriame checkbox ir pridedame ikonƒÖ
                itemDiv.innerHTML = `
                    <input type="checkbox" id="item-${item.name.replace(/\s+/g, '')}" style="margin-right: 10px;">
                    <label for="item-${item.name.replace(/\s+/g, '')}" style="display: flex; justify-content: space-between; width: 100%; align-items: center; cursor: pointer;">
                        <span class="item-name">${item.name}</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="item-info-icon">‚ìò</span>
                            <strong class="item-points">${item.points > 0 ? '+' : ''}${item.points} t≈°k.</strong>
                        </div>
                    </label>
                `;

                const checkbox = itemDiv.querySelector('input');
                const infoIcon = itemDiv.querySelector('.item-info-icon');

                // Pridedame logikƒÖ informacijos ikonai
                infoIcon.onclick = (e) => {
                    e.stopPropagation(); // Sustabdo evento perdavimƒÖ toliau
                    e.preventDefault(); // Sustabdo checkbox pa≈æymƒójimƒÖ
                    alert(`${item.name}\n\n${item.reality}`);
                };
                
                // Checkbox logika
                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        temporarySelections.push(item);
                    } else {
                        temporarySelections = temporarySelections.filter(selected => selected.name !== item.name);
                    }
                });

                dom.modalList.appendChild(itemDiv);
            });

            const confirmBtn = dom.modal.querySelector('#modal-confirm-btn');
            confirmBtn.onclick = () => {
                onConfirmCallback(temporarySelections);
            };

            dom.modal.classList.add('active');
        }

        dom.startBtn.addEventListener('click', initGame);
        dom.rulesBtn.addEventListener('click', () => alert("≈Ωaidimo tikslas:\n\n1. Suplanuokite visƒÖ savaitƒô, priimdami sprendimus kiekvienai dienai.\n2. Startuojate su 100 eko-ta≈°k≈≥.\n3. Stenkitƒós nevir≈°yti biud≈æeto!\n\nLaimi tas, kas sukuria tvar≈≥ ir smag≈≥ savaitƒós planƒÖ."));
        dom.finishBtn.addEventListener('click', () => {
            if (dom.finishBtn.classList.contains('disabled')) {
                alert('Ruo≈°iatƒós badauti?');
                return; // Sustabdo tolimesnƒØ funkcijos vykdymƒÖ
            }
            const createSummaryList = (title, items) => {
                if (items.length === 0) return '';
                const actionItemsHTML = items.map(action => `<li>‚Ä¢ ${action.name}</li>`).join('');
                return `<br><br><b>${title}:</b><ul style="list-style-type: none; padding-left: 0; text-align: left; font-size: 0.9em;">${actionItemsHTML}</ul>`;
            };

            const allFoodItems = weeklyPlan.flatMap(day => [...day['Pusryƒçiai'], ...day['Piet≈´s'], ...day['Vakarienƒó']]);
            const allTransportItems = weeklyPlan.flatMap(day => day['Transportas']);
            const allGeneralActions = weeklyPlan.flatMap(day => day['Bendri veiksmai']);

            let summaryHTML = '';
            summaryHTML += createSummaryList('Pasirinktas maistas', allFoodItems);
            summaryHTML += createSummaryList('Pasirinktas transportas', allTransportItems);
            summaryHTML += createSummaryList('Kiti pasirinkti veiksmai', allGeneralActions);

            if (currentScore >= 0) {
                dom.endTitle.textContent = "Sveikiname! ü•≥";
                dom.endMessage.innerHTML = `J≈´s sƒókmingai suplanavote savaitƒô ir likote biud≈æete! J≈´s≈≥ galutinis likutis: ${currentScore} eko-ta≈°k≈≥.` + summaryHTML;
            } else {
                
                dom.endMessage.innerHTML = `Vir≈°ijote biud≈æetƒÖ ${-currentScore} ta≈°kais.` + summaryHTML;
            }
            showScreen('end-screen');
        });
        dom.restartBtn.addEventListener('click', () => showScreen('start-screen'));
        
        function closeModal() {
            if (isWednesdayEventActive) {
                applyWednesdayDefault();
            }
            dom.modal.classList.remove('active');
        }

        dom.modalCloseBtn.addEventListener('click', closeModal);
        dom.modal.addEventListener('click', (e) => { 
            if (e.target === dom.modal) {
                closeModal();
            }
        });
        
        function triggerWednesdayEvent() {
            isWednesdayEventActive = true; 
            isWednesdayEventTriggered = true; // Pa≈æymime, kad ƒØvykis ƒØvyko
            dom.modalTitle.textContent = 'Nelaimƒó treƒçiadienƒØ!';
            dom.modalList.innerHTML = `
                <p style="text-align: left; margin-bottom: 20px;">Tavo i≈°manusis telefonas ƒØkrito ƒØ klozetƒÖ dar nespƒójus nuleisti to, kas jame pl≈´duriuoja (dienƒÖ prie≈° suvalgei kebabƒÖ, kuris labai susipyko su tavo skrand≈æiu). KƒÖ darai?</p>
            `;

            const choices = [
                { text: 'Perki naujƒÖ i≈°man≈≥jƒØ telefonƒÖ', points: -75, reality: 'Realybƒó: ~60-90 kg CO‚ÇÇe. Apie 80% telefono pƒódsako atsiranda gamybos metu dƒól ret≈≥j≈≥ metal≈≥ kasybos, energijai imli≈≥ proces≈≥ ir transportavimo. Kiekvienas naujas telefonas yra did≈æiulƒó na≈°ta planetai.', penalty: true },
                { text: 'Perki naudotƒÖ telefonƒÖ', points: -10, reality: 'Realybƒó: Poveikis artimas nuliui. J≈´s neinicijuojate naujos gamybos, o pratƒôsiate jau pagaminto produkto gyvavimo ciklƒÖ. PƒódsakƒÖ sudaro tik transportavimas. Tai vienas efektyviausi≈≥ b≈´d≈≥ ma≈æinti elektronikos atliekas ir resurs≈≥ naudojimƒÖ.', penalty: true },
                { text: 'Greitai bandai i≈°gelbƒóti telefonƒÖ', points: 15, reality: 'Realybƒó: J≈´s ‚Äûsutaupote‚Äú visas emisijas ir resursus, kurie b≈´t≈≥ buvƒô panaudoti naujo daikto gamybai.', penalty: false }
            ];

            choices.forEach(choice => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'modal-item';
                itemDiv.style.flexDirection = 'column';
                itemDiv.style.alignItems = 'flex-start';
                itemDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; width: 100%;">
                        <span>${choice.text}</span>
                        <strong style="white-space: nowrap;">${choice.points > 0 ? '+' : ''}${choice.points} t≈°k.</strong>
                    </div>
                    <small style="margin-top: 5px; color: #555;">${choice.reality}</small>
                `;
                itemDiv.onclick = () => {
                    isWednesdayEventActive = false;
                    const eventItem = { name: choice.text, points: choice.points, reality: choice.reality };
                    weeklyPlan[2]['Bendri veiksmai'].push(eventItem);
                    updateScore(choice.points);

                    if (choice.penalty) {
                        const penaltyItem = { name: 'Seno telefono pavertimas elektronine atlieka', points: -5, reality: 'I≈°metus telefonƒÖ ƒØ bendrƒÖ konteinerƒØ, jis tampa pavojinga atlieka. Netinkamai tvarkoma elektronika ƒØ aplinkƒÖ i≈°skiria toksi≈°kus metalus (≈°vinƒÖ, gyvsidabrƒØ), kurie kenkia ekosistemoms ir ≈æmoni≈≥ sveikatai.' };
                        weeklyPlan[2]['Bendri veiksmai'].push(penaltyItem);
                        updateScore(-5);
                    }
                    
                    renderPlanForDay(2);
                    dom.modal.classList.remove('active');
                };
                dom.modalList.appendChild(itemDiv);
            });

            dom.modal.classList.add('active');
        }

        function applyWednesdayDefault() {
            isWednesdayEventActive = false;
            const defaultChoice = { 
                name: 'Gyvenimas be i≈°maniojo telefono', 
                points: 20,
                reality: 'J≈´s visi≈°kai i≈°vengiate did≈æiausio asmeninƒós elektronikos poveikio ‚Äì gamybos. Tai prilygsta (-75 t≈°k.) pƒódsako eliminavimui kas kelerius metus. J≈´s taip pat drasti≈°kai suma≈æinate savo skaitmeninƒØ pƒódsakƒÖ ir energijos suvartojimƒÖ. Realybƒóje, 2025 metais, tai yra did≈æiulis i≈°≈°≈´kis: prarandama prieiga prie mobiliosios bankininkystƒós, ≈æemƒólapi≈≥, momentini≈≥ ≈æinuƒçi≈≥ programƒóli≈≥, ‚ÄûBolt‚Äú ar ‚ÄûCityBee‚Äú paslaug≈≥.'
            };
            weeklyPlan[2]['Bendri veiksmai'].push(defaultChoice);
            updateScore(defaultChoice.points);
            renderPlanForDay(2);
        }
    });
    </script>
</body>
</html>
