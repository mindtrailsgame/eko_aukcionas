<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tvarumo Aukcionas</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #2c6e49;
            --secondary-color: #fefee3;
            --accent-color: #ffc94b;
            --danger-color: #d9534f;
            --light-bg: #f9f9f9;
            --info-color: #4a90e2;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--light-bg);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .phone-wrapper {
            width: 100%;
            max-width: 400px;
            height: 100vh;
            max-height: 800px;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .screen { display: none; flex-direction: column; height: 100%; padding: 20px; box-sizing: border-box; text-align: center; }
        .screen.active { display: flex; }
        #start-screen { justify-content: center; gap: 20px; }
        #start-screen h1 { font-size: 2.5em; color: var(--primary-color); }
        #start-screen p { font-size: 1.1em; line-height: 1.5; }
        #game-screen { padding: 0; }
        .game-header { background-color: var(--primary-color); color: white; padding: 15px 20px; border-bottom: 4px solid var(--accent-color); }
        .game-header h2 { margin: 0; font-size: 1.2em; }
        .score-display { font-size: 2em; font-weight: bold; margin-top: 5px; transition: color 0.3s; }
        .day-nav { display: flex; justify-content: space-around; padding: 10px 0; background-color: #f0f0f0; }
        .day-btn { background: none; border: 2px solid transparent; padding: 8px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .day-btn.active { border-color: var(--primary-color); background-color: var(--secondary-color); }
        .plan-area { flex-grow: 1; padding: 20px; overflow-y: auto; text-align: left; }
        .plan-slot { background-color: #fff; border: 1px dashed #ccc; border-radius: 8px; margin-bottom: 15px; padding: 15px; }
        .plan-slot h3, .plan-area h2 { margin: 0 0 10px 0; color: var(--primary-color); }
        .slot-content { min-height: 24px; }
        .add-btn { background: none; border: none; color: var(--primary-color); font-weight: bold; font-size: 1em; cursor: pointer; }
        .action-buttons-container { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }
        .action-btn { background-color: var(--secondary-color); color: var(--primary-color); border: 1px solid var(--primary-color); padding: 10px; border-radius: 8px; text-align: center; cursor: pointer; font-weight: bold; }
        #end-screen {
            justify-content: flex-start; /* Pradeda turinƒØ nuo vir≈°aus */
            gap: 20px;
            overflow-y: auto; /* Prideda scroll, jei reikia */
        }
        .btn { padding: 15px 25px; font-size: 1.2em; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .btn-primary { background-color: var(--accent-color); color: var(--primary-color); }
        .btn-secondary { background-color: #eee; color: #555; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background-color: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 380px; max-height: 80%; overflow-y: auto; }
        .modal-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; gap: 10px; }
        .modal-item:hover { background-color: var(--secondary-color); }
        .item-name { flex-grow: 1; }
        .item-points { font-weight: bold; white-space: nowrap; }
        .item-info-icon { font-weight: bold; color: var(--info-color); cursor: help; border-radius: 50%; width: 20px; height: 20px; display: inline-flex; justify-content: center; align-items: center; border: 1px solid var(--info-color); }
        .general-actions-list { list-style-type: none; padding: 0; margin-top: 10px; }
        .general-actions-list li { background: #f0f0f0; padding: 5px 10px; border-radius: 5px; font-size: 0.9em; margin-bottom: 5px; }
        .btn.disabled {
            background-color: #ccc;
            color: #888;
            cursor: not-allowed;
            border-color: #ccc;
        }
      

        /* Pridƒókite ≈°iuos stilius ƒØ savo <style> ≈æymƒÖ */

        /* Nauja ≈æaidimo ekrano strukt≈´ra */
        #game-screen {
            padding: 0; /* Panaikiname senƒÖ padding */
        }

        /* Pridƒókite ≈°ƒØ kodƒÖ ƒØ <style> ≈æymƒÖ */

        @keyframes pulse-border {
        0% {
            box-shadow: 0 0 0 0 rgba(44, 110, 73, 0.7);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(44, 110, 73, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(44, 110, 73, 0);
        }
        }

        .highlight-for-drop {
        border-color: var(--primary-color);
        border-style: solid;
        animation: pulse-border 2s 2; /* Paleis animacijƒÖ 2 kartus */
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-2deg) translateX(-2px); }
            75% { transform: rotate(2deg) translateX(2px); }
            }

            /* Klasƒó, kuriƒÖ priskirsime pirmajam elementui */
            .first-item-hint {
            animation: wiggle 0.5s 3; /* Paleis animacijƒÖ 3 kartus */
            cursor: grab; /* Pakeiƒçia pelƒós ≈æymeklƒØ, kad b≈´t≈≥ dar ai≈°kiau */
            }

            /* Stilius instrukcijos tekstui ≈°oninƒóje juostoje */
            .sidebar-hint-text {
            background-color: var(--secondary-color);
            border: 1px solid var(--accent-color);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
            color: var(--primary-color);
            }

        .bin-btn {
            padding: 15px;
            border-radius: 8px;
            border: 2px solid;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: transform 0.1s;
            }
            .bin-btn:active {
                transform: scale(0.95);
            }
            .bin-btn.plastikas { background-color: #ffc94b; border-color: #e6b544; color: #333; }
            .bin-btn.popierius { background-color: #4a90e2; border-color: #4281cb; color: white; }
            .bin-btn.stiklas { background-color: #2c6e49; border-color: #255c3c; color: white; }
            .bin-btn.buitines { background-color: #666; border-color: #555; color: white; }
            .bin-btn.pavojingos { background-color: #d9534f; border-color: #c44b47; color: white; }

            /* Stiliai teisingam/neteisingam atsakymui */
            #sorting-feedback.correct { color: var(--primary-color); }
            #sorting-feedback.incorrect { color: var(--danger-color); }

        .game-content-wrapper {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .main-content {
            flex: 1; /* U≈æima visƒÖ likusiƒÖ erdvƒô */
            display: flex;
            flex-direction: column;
        }

        /* Nauja veiksm≈≥ ≈°oninƒó juosta */
        .actions-sidebar {
            width: 280px; /* Fiksuotas plotis */
            background-color: #f0f0f0;
            border-left: 1px solid #ddd;
            overflow-y: auto;
            padding: 15px;
            box-sizing: border-box;
        }

        .actions-sidebar h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 5px;
        }
        .actions-sidebar h3:first-child {
            margin-top: 0;
        }

        /* Stilius velkamiems elementams */
        .draggable-item {
            background-color: white;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: grab;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            transition: box-shadow 0.2s, background-color 0.2s;
        }

        .draggable-item:hover {
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .draggable-item.disabled {
            background-color: #e9e9e9;
            color: #999;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* Stilius, kai elementas velkamas vir≈° planavimo laukelio */
        .plan-slot.drag-over {
            border-style: solid;
            border-color: var(--primary-color);
            background-color: var(--secondary-color);
        }

                /* Pridƒókite ≈°iuos stilius ƒØ <style> ≈æymƒÖ */
        .item-name-sidebar {
            flex: 1;
            /* Leid≈æia tekstui persikelti, jei jis per ilgas */
            white-space: normal; 
            padding-right: 8px; /* Prideda tarpelƒØ tarp teksto ir ta≈°k≈≥ */
        }

        .item-points-sidebar {
            /* Neleid≈æia ta≈°k≈≥ tekstui l≈´≈æti ƒØ kelias eilutes */
            white-space: nowrap;
            text-align: right;
        }
        
        /* ≈†iuos stilius ƒØdƒókite prie kit≈≥ CSS taisykli≈≥ */
        .game-content-wrapper {
            position: relative; 
        }
        .actions-sidebar {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            z-index: 100;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .actions-sidebar.visible {
            transform: translateX(0);
        }
        .sidebar-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 99;
        }
        .sidebar-overlay.visible {
            display: block;
        }
        .plan-slot h3 {
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-decoration-color: var(--accent-color);
        }

        /* Pridƒókite ≈°ƒØ kodƒÖ ƒØ <style> ≈æymƒÖ */

        /* Apibrƒó≈æiame paƒçiƒÖ animacijƒÖ */
        @keyframes glow {
        0%, 100% {
            box-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
        }
        50% {
            box-shadow: 0 0 15px 3px rgba(74, 144, 226, 1);
        }
        }

/* Klasƒó, kuri priskirs animacijƒÖ ikonai */
.info-icon-glow {
  animation: glow 1.5s 2; /* Paleis animacijƒÖ 2 kartus, bendra trukmƒó 3s */
}

    </style>
</head>
    <body>
    <div class="phone-wrapper">

        <div id="start-screen" class="screen active">
            <h1>Tvarumo Aukcionas üåç</h1>
            <p>Suplanuokite savaitƒô, nevir≈°ydami 100 eko-ta≈°k≈≥ biud≈æeto. Sƒókmƒós!</p>
            <button id="start-btn" class="btn btn-primary">Pradƒóti ≈æaidimƒÖ</button>
            <button id="rules-btn" class="btn btn-secondary">Kaip ≈æaisti?</button>
        </div>

        <div id="game-screen" class="screen">
            <div class="game-content-wrapper">
                <div id="sidebar-overlay" class="sidebar-overlay"></div>
                
                <div class="main-content">
                    <header class="game-header">
                        <h2>Likutis:</h2>
                        <div id="score" class="score-display">100/100 t≈°k.</div>
                    </header>
                    <nav class="day-nav" id="day-nav"></nav>
                    <main class="plan-area" id="plan-area"></main>
                    <button id="finish-btn" class="btn btn-primary" style="margin: 20px; border-radius: 8px;">Baigti planavimƒÖ</button>
                </div>
                <aside id="actions-sidebar" class="actions-sidebar"></aside>
            </div>
        </div>

        <div id="end-screen" class="screen">
            <h2 id="end-title">Rezultatas</h2>
            <p id="end-message" style="font-size: 1.2em;"></p>
            <button id="restart-btn" class="btn btn-primary">≈Ωaisti i≈° naujo</button>
        </div>


    </div>
    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Pasirinkite veiksmƒÖ</h3>
            <div id="modal-list"></div>
            <div id="modal-footer" style="margin-top: 20px; display: flex; justify-content: space-between;">
                <button id="modal-close-btn" class="btn btn-secondary">U≈ædaryti</button>
                <button id="modal-confirm-btn" class="btn btn-primary" style="display: none;">Patvirtinti</button>
            </div>  
        </div>
    </div>

    <div id="sorting-modal" class="modal">
        <div class="modal-content" style="text-align: center;">
            <h3 id="sorting-title">R≈´≈°iavimo I≈°≈°≈´kis!</h3>
            <p id="sorting-progress"></p>
            <div id="sorting-question" style="font-size: 1.3em; margin: 20px 0; font-weight: bold;"></div>
            
            <div id="sorting-feedback" style="min-height: 24px; font-weight: bold; margin-bottom: 15px;"></div>

            <div id="sorting-bins" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                </div>

             <div id="sorting-explanation" style="font-size: 0.9em; color: #555; margin-top: 20px; text-align: left; background: #f0f0f0; padding: 10px; border-radius: 5px; display: none;">
                </div>
        </div>
    </div>
   
        
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let myChart; 
        // --- DATA FROM PDF (UPDATED) ---
        
        const items = {
            'Maistas': [
                { name: 'Jautienos kepsnys ar mƒósainis', points: -15, reality: 'Viena 200 g porcija jautienos ‚Äûkainuoja‚Äú apie 12-20 kg CO2e. Tai prilygsta ma≈ædaug 100 km kelionei automobiliu.', co2e: 16, waterUsed: 1500 },
                { name: 'Pica su s≈´riu ar patiekalas su daug s≈´rio', points: -10, reality: 'S≈´rio gamyba yra antras did≈æiausias maisto pramonƒós ter≈°ƒójas po jautienos. 1 kg s≈´rio apie 10-20 kg CO2e.', co2e: 15, waterUsed: 1200 },
                { name: 'Patiekalas su vi≈°tiena', points: -8, reality: '1 kg vi≈°tienos - apie 6 kg CO2e. ≈Ωymiai ma≈æiau nei jautienos, bet vis tiek reik≈°mingai daugiau nei augalinio maisto.', co2e: 6, waterUsed: 600 },
                { name: 'Patiekalas su ≈æuvimi (pvz., la≈°i≈°a i≈° fermos)', points: -6, reality: 'Priklauso nuo ≈æuvies, bet 1 kg la≈°i≈°os i≈° fermos gamyba gali siekti apie 11 kg CO2e.', co2e: 11 },
                { name: 'Patiekalas su importuotais augaliniais produktais', points: -4, reality: 'Nors poveikis ma≈æesnis, tolimas transportavimas ir didelis vandens suvartojimas (pvz., 1 kg avokad≈≥ gali prireikti iki 2000 litr≈≥ vandens) palieka pƒódsakƒÖ.', co2e: 2, waterUsed: 1000 },
                { name: 'Sumu≈°tiniai su dar≈æovƒómis (+ priedas)', points: -3, reality: 'Apie 0.3 kg CO2e. Priedai su gyv≈´ninƒós kilmƒós produktais ≈æenkliai padidina pƒódsakƒÖ.', co2e: 0.3 },
                { name: 'Vietinƒó ko≈°ƒó ar vietini≈≥ dar≈æovi≈≥ sriuba/tro≈°kinys', points: -2, reality: 'Poveikis minimalus. 1 kg lƒô≈°i≈≥ - ma≈æiau nei 1 kg CO2e.', co2e: 0.8, waterSaved: 500 },
            ],
            'Gƒórimai': [
                { name: 'Kava vienkartiniame puodelyje', points: -2, reality: 'Pats popierinis puodelis su plastikiniu dangteliu turi apie 0.1 kg CO‚ÇÇe pƒódsakƒÖ. Per metus tai gali susidaryti ƒØ reik≈°mingƒÖ kiekƒØ.', co2e: 0.1 },
                { name: 'Energinis gƒórimas / gƒórimas skardinƒóje', points: -4, reality: 'Apie 0.3-0.5 kg CO2e. Did≈æiausiƒÖ poveikƒØ daro aliuminio skardinƒós gamyba, kuri yra itin imli energijai.', co2e: 0.4 },
                { name: 'Vanduo i≈° ƒçiaupo (ƒØ savo gertuvƒô ar puodelƒØ)', points: 1, reality: 'Realybƒó: Poveikis prakti≈°kai nulinis. Gertuvƒós naudojimas padeda i≈°vengti ≈°imt≈≥ plastikini≈≥ buteli≈≥ per metus.', co2e: 0, waterSaved: 1.5 }

            ],
            'Transportas': [
                { name: 'Kelionƒó automobiliu (vienam/dviese)', points: -14, reality: 'Vidutinis benzininis automobilis i≈°meta apie 170 g CO2/km. 40 km kelionƒó pirmyn ir atgal - apie 6.8 kg CO2e.', co2e: 6.8 },
                { name: 'Kelionƒó vie≈°uoju transportu', points: -4, reality: 'Poveikis i≈°sidalina visiems keleiviams. Vienam ≈æmogui tenkanti emisija 40 km kelionei yra apie 1.6 kg CO‚ÇÇe.', co2e: 1.6 },
                { name: 'Kelionƒó dviraƒçiu, paspirtuku ar pƒósƒçiomis', points: 2, reality: 'Poveikis aplinkai - prakti≈°kai 0.', co2e: 0 },
            ],
            'U≈ækand≈æiai ir gƒórimai': [
                { name: '‚ÄûPringles" tra≈°kuƒçi≈≥ t≈´telƒó', points: -6, reality: 'Realybƒó: ~0.7 kg CO‚ÇÇe. ≈†is produktas yra ‚Äûekologinis ko≈°maras‚Äú dƒól pakuotƒós. T≈´telƒó pagaminta i≈° keli≈≥ med≈æiag≈≥ (kartono, metalo, plastikinio dangtelio), todƒól jos prakti≈°kai neƒØmanoma perdirbti.', co2e: 0.7 },
                { name: '‚ÄûEstrella" ar ‚ÄûOho!" tra≈°kuƒçi≈≥ pakelis', points: -5, reality: 'Realybƒó: ~0.4-0.6 kg CO‚ÇÇe. Nors paƒçi≈≥ tra≈°kuƒçi≈≥ pƒódsakas pana≈°us, pakuotƒó yra ≈°iek tiek ma≈æesnis blogis nei ‚ÄûPringles‚Äú, taƒçiau vis tiek pagaminta i≈° daugiasluoksnio, sunkiai perdirbamo plastiko ir aliuminio folijos.', co2e: 0.5 },
                { name: '‚ÄûMagija" glaistytas s≈´relis', points: -4, reality: 'Realybƒó: ~0.3-0.5 kg CO‚ÇÇe. Pieno produkt≈≥ gamyba (var≈°kƒó, sviestas) yra imli resursams. Taip pat prisideda neperdirbama daugiasluoksnƒó pakuotƒó.', co2e: 0.4, waterUsed: 50 },
                { name: '≈†okoladukas ‚ÄûKar≈´na"', points: -4, reality: 'Realybƒó: Poveikis labai priklauso nuo ingredient≈≥. Pieno milteliai, palmi≈≥ aliejus (da≈ænai susijƒôs su mi≈°k≈≥ kirtimu) ir netvariai auginama kakava sudaro did≈æiƒÖjƒÖ dalƒØ pƒódsako.', co2e: 0.3 },
                { name: '‚ÄûCoca-Cola" gƒórimas (0.5 l plastikiniame butelyje)', points: -3, reality: 'Realybƒó: ~0.2-0.3 kg CO‚ÇÇe. Plastikinis (PET) butelis gaminamas i≈° naftos. Prie pƒódsako prisideda ne tik butelio gamyba, bet ir cukraus gamyba, transportavimas.', co2e: 0.25 },
                { name: '‚ÄûCoca-Cola" gƒórimas (0.33 l skardinƒóje)', points: -4, reality: 'Realybƒó: ~0.3-0.5 kg CO‚ÇÇe. Aliuminio gamyba yra itin imli energijai, todƒól skardinƒó palieka didesnƒØ pƒódsakƒÖ nei plastikinis butelis.', co2e: 0.4 },
                { name: '‚ÄûSmetoni≈°ka" gira (1 l plastikiniame butelyje)', points: -2, reality: 'Realybƒó: ~0.3 kg CO‚ÇÇe (u≈æ visƒÖ butelƒØ). Gira da≈ænai yra lokalesnis produktas, reikalaujantis ma≈æiau sudƒóting≈≥, importuojam≈≥ ingredient≈≥ ir trumpesnio transportavimo kelio.', co2e: 0.3 },
                { name: '‚ÄûNept≈´no" vanduo (0.5 l plastikiniame butelyje)', points: -3, reality: 'Realybƒó: ~0.15 kg CO‚ÇÇe. VisƒÖ ≈æalƒÖ daro plastikinƒó pakuotƒó ir transportavimas, ypaƒç kai Lietuvoje turime auk≈°tos kokybƒós vandenƒØ i≈° ƒçiaupo.', co2e: 0.15 },
                { name: 'Lietuvi≈°kas obuolys ar morka (be pakuotƒós)', points: 0, reality: 'Realybƒó: Poveikis artimas nuliui. Vietinis, sezoninis produktas be jokios pakuotƒós. Pats tvariausias pasirinkimas.', co2e: 0.01, waterSaved: 100 },
                { name: 'Vanduo i≈° ƒçiaupo (ƒØ savo gertuvƒô)', points: 1, reality: 'Realybƒó: Poveikis prakti≈°kai nulinis. Gertuvƒós naudojimas padeda i≈°vengti ≈°imt≈≥ plastikini≈≥ buteli≈≥ per metus.', co2e: 0, waterSaved: 1.5 }
            ],
            'Pirkiniai ir pramogos': [
                { name: 'Skrydis lƒóktuvu savaitgalio i≈°vykai', points: -80, reality: 'Toks skrydis ƒØ abi puses vienam asmeniui i≈°meta apie 250-300 kg CO2e. Tai daugiau, nei tvarus metinis CO2 biud≈æetas leid≈æia transportui.', isWeekly: true, co2e: 275 },
                { name: 'Naujas i≈°manusis telefonas', points: -75, reality: 'Apie 80% telefono CO2 pƒódsako atsiranda gamybos metu. Tai sudaro apie 60-90 kg CO2e, neƒØskaitant ret≈≥j≈≥ metal≈≥ kasybos poveikio.', co2e: 75},
                { name: 'Naujas greitosios mados drabu≈æis (pvz., d≈æinsai)', points: -30, reality: 'Viena pora d≈æins≈≥ ‚Äì apie 33 kg CO2e ir ~3,700 litr≈≥ vandens. Tai prilygsta 111 km kelionei automobiliu ir 3 met≈≥ geriamojo vandens kiekiui vienam ≈æmogui.', co2e: 33, waterUsed: 3700 },
                { name: 'Drabu≈æis ar daiktas i≈° antr≈≥ rank≈≥ parduotuvƒós', points: -3, reality: 'Poveikis artimas nuliui, nesukuriama nauja paklausa gamybai. PƒódsakƒÖ sudaro tik transportavimas iki parduotuvƒós.', co2e: 0.1},
                { name: 'Apsilankymas kine', points: -5, reality: 'Poveikis nedidelis, daugiausia susijƒôs su pastato energijos vartojimu.', co2e: 1.5},
                { name: 'Pasivaik≈°ƒçiojimas parke / ≈æygis mi≈°ke', points: 3, reality: 'Skatina ry≈°ƒØ su gamta, jos vertinimƒÖ ir i≈°saugojimƒÖ.', co2e: 0},
                { name: 'Skaitmeninƒós knygos skaitymas (e. knyga)', points: -2, reality: 'Pats skaitymo ir atsisiuntimo procesas yra labai taupus (~20-50 g CO‚ÇÇe). Palyginimui, naujos popierinƒós knygos pƒódsakas - apie 1-3 kg CO2e. Taƒçiau didysis ‚Äûbet" yra skaitymo ƒØrenginio (skaityklƒós, plan≈°etƒós) gamyba, kuri siekia ~30-50 kg CO2e. Vadinasi, kad skaityklƒó atsipirkt≈≥ ekologi≈°kai, ja reikia perskaityti de≈°imtis knyg≈≥, kurias antraip b≈´tumƒóte pirkƒô popierines. Pats tvariausias pasirinkimas - skaityti knygas i≈° bibliotekos!', co2e: 0.03},
                { name: 'Nauja knyga (popierinƒó)', points: -6, reality: 'Vidutinƒó knyga palieka apie 1-3 kg CO‚ÇÇe pƒódsakƒÖ dƒól popieriaus gamybos, spausdinimo ir transportavimo.', co2e: 2},
            ],
            'Skaitmeninis pasaulis ir buitis': [
                { name: 'Video ≈æaidimai galingu kompiuteriu (u≈æ dienƒÖ)', points: -4, reality: 'Galingas ≈æaidim≈≥ kompiuteris gali vartoti tiek pat energijos, kiek keli ≈°aldytuvai. Kelios valandos ≈æaidimo - apie 0.5-1 kg CO‚ÇÇe.', co2e: 0.8},
                { name: 'Dirbtinio intelekto (ChatGPT) aktyvus naudojimas (u≈æ dienƒÖ)', points: -3, reality: 'Nors viena u≈æklausa palieka ma≈æƒÖ pƒódsakƒÖ, intensyvus naudojimas per valandƒÖ gali sugeneruoti apie 0.5-7.5 g CO2e dƒól duomen≈≥ centr≈≥ energijos.', co2e: 0.005},
                { name: 'Nar≈°ymas socialiniuose tinkluose (1-2 val. per dienƒÖ)', points: -2, reality: 'Valanda nar≈°ymo sugeneruoja apie 60-120 g CO2e. ‚ÄûDebesis‚Äú (cloud) i≈° ties≈≥ yra did≈æiuliai, fizi≈°kai egzistuojantys ir daug energijos reikalaujantys pastatai.', co2e: 0.1},
                { name: 'I≈°maniojo telefono ƒØkrovimas (u≈æ visƒÖ savaitƒô)', points: -1, reality: 'Pats ƒØkrovimas yra menkas (5-10 g CO‚ÇÇe), bet tai priminimas apie did≈æiausiƒÖ telefono poveikƒØ - gamybƒÖ (60-90 kg CO‚ÇÇ–µ).', isWeekly: true, co2e: 0.01 },
                { name: 'Skalbimas ir d≈æiovinimas el. d≈æiovyklƒóje (u≈æ 1 ciklƒÖ)', points: -5, reality: 'D≈æiovyklƒó yra vienas daugiausiai energijos vartojanƒçi≈≥ prietais≈≥. Vienas ciklas - apie 1-2 kg CO2e.', co2e: 1.5, waterUsed: 50},
            ],
            'Pozityv≈´s veiksmai': [
                { name: 'Savaitƒô nepirkti nieko, kas supakuota ƒØ vienkartinƒØ plastikƒÖ', points: 10, reality: 'Ma≈æinate plastiko tar≈°ƒÖ ir i≈°kastinio kuro vartojimƒÖ, nes plastikas gaminamas i≈° naftos.', isWeekly: true, co2e: -5 },
                { name: 'Kruop≈°tus r≈´≈°iavimas visƒÖ savaitƒô', points: 10, reality: 'Perdirbimas taupo energijƒÖ ir gamtos i≈°teklius. Pvz., pagaminti skardinƒô i≈° perdirbto aliuminio reikia 95% ma≈æiau energijos.', isWeekly: true, co2e: -2 }
            ]
        };

        const STARTING_POINTS = 100;
        const WEEKDAYS = ['P', 'A', 'T', 'K', 'Pn', '≈†', 'S'];
        const DAY_NAMES = ['Pirmadienis', 'Antradienis', 'Treƒçiadienis', 'Ketvirtadienis', 'Penktadienis', '≈†e≈°tadienis', 'Sekmadienis'];

            const PLAN_SLOTS = [
        { title: 'Pusryƒçiai', allowedCategories: ['Maistas', 'Gƒórimai'] },
        { title: 'Piet≈´s', allowedCategories: ['Maistas', 'Gƒórimai'] },
        { title: 'Vakarienƒó', allowedCategories: ['Maistas', 'Gƒórimai'] },
        { title: 'Transportas', allowedCategories: ['Transportas'] },
        { title: 'U≈ækand≈æiai ir gƒórimai', allowedCategories: ['U≈ækand≈æiai ir gƒórimai'] },
        { title: 'Pirkiniai ir pramogos', allowedCategories: ['Pirkiniai ir pramogos'] },
        { title: 'Buitis ir Skaitmena', allowedCategories: ['Skaitmeninis pasaulis ir buitis'] },
        { title: 'Pozityv≈´s veiksmai', allowedCategories: ['Pozityv≈´s veiksmai'] }
    ];

        let currentScore, currentDay, weeklyPlan, chosenWeeklyActions, isWednesdayEventTriggered, isWednesdayEventActive, isGameFinished, isFirstHintShown;
        const STORAGE_KEY = 'sustainabilityGameProgress'; // Key to store our game data

        function saveGameState() {
            const gameState = {
                currentScore,
                currentDay,
                weeklyPlan,
                chosenWeeklyActions,
                isWednesdayEventTriggered,
                isGameFinished
            };
            // localStorage can only store strings, so we convert our object to a JSON string.
            localStorage.setItem(STORAGE_KEY, JSON.stringify(gameState));
            console.log("Game saved! üíæ");
        }

        function loadGameState() {
            const savedStateJSON = localStorage.getItem(STORAGE_KEY);
            if (savedStateJSON) {
                const savedState = JSON.parse(savedStateJSON);
                // Restore all variables from the saved state
                currentScore = savedState.currentScore;
                currentDay = savedState.currentDay;
                weeklyPlan = savedState.weeklyPlan;
                chosenWeeklyActions = savedState.chosenWeeklyActions;
                isWednesdayEventTriggered = savedState.isWednesdayEventTriggered;
                isGameFinished = savedState.isGameFinished || false; // Handle old saves that don't have this flag

                if (isGameFinished) {
                    console.log("Found finished game. Showing results... üèÜ");
                    displayEndScreen(); // Directly show the end screen
                } else {
                    console.log("Found saved game. Loading... ‚ú®");
                    updateScore(0);
                    renderDayNav();
                    renderPlanForDay(currentDay);
                    showScreen('game-screen');
                }
                return true;
            }
            return false;
        }   

        // Atnaujinkite `dom` objektƒÖ, kad jis atrodyt≈≥ taip:
        // Atnaujinkite `dom` objektƒÖ, kad atrodyt≈≥ taip:
        const dom = {
            screens: document.querySelectorAll('.screen'),
            startBtn: document.getElementById('start-btn'),
            rulesBtn: document.getElementById('rules-btn'),
            finishBtn: document.getElementById('finish-btn'),
            restartBtn: document.getElementById('restart-btn'),
            scoreDisplay: document.getElementById('score'),
            dayNav: document.getElementById('day-nav'),
            planArea: document.getElementById('plan-area'),
            actionsSidebar: document.getElementById('actions-sidebar'),
            endTitle: document.getElementById('end-title'),
            endMessage: document.getElementById('end-message'),
            
            modal: document.getElementById('modal'),
            modalTitle: document.getElementById('modal-title'),
            modalList: document.getElementById('modal-list'),
            modalCloseBtn: document.getElementById('modal-close-btn'),

            // --- PRIDƒñKITE TR≈™KSTAMƒÑ EILUTƒò ƒåIA ---
            sidebarOverlay: document.getElementById('sidebar-overlay'),
            sortingModal: document.getElementById('sorting-modal'),
            sortingTitle: document.getElementById('sorting-title'),
            sortingProgress: document.getElementById('sorting-progress'),
            sortingQuestion: document.getElementById('sorting-question'),
            sortingFeedback: document.getElementById('sorting-feedback'),
            sortingBins: document.getElementById('sorting-bins'),
            sortingExplanation: document.getElementById('sorting-explanation')
            
        };

        // --- PRAD≈ΩIA: Duomenys ir kintamieji r≈´≈°iavimo ≈æaidimui ---
        const sortingQuestions = [
            { item: 'Sutepta picos dƒó≈æƒó', correctBin: 'buitines', explanation: 'Riebalais ar maisto likuƒçiais suteptas popierius ir kartonas nƒóra perdirbami, todƒól keliauja ƒØ buitini≈≥ atliek≈≥ konteinerƒØ.' },
            { item: 'Stiklainis nuo agurk≈≥', correctBin: 'stiklas', explanation: '≈†varus stiklainis be dangtelio visada keliauja ƒØ stiklo konteinerƒØ. Dangtelis (jei metalinis) ‚Äì ƒØ plastikƒÖ.' },
            { item: 'Panaudota baterija', correctBin: 'pavojingos', explanation: 'Baterijos, akumuliatoriai ir lemputƒós yra pavojingos atliekos. Jas reikia mesti ƒØ specialias dƒó≈æutes prekybos centruose.' },
            { item: 'Plastikinis butelis nuo gƒórimo', correctBin: 'plastikas', explanation: 'Visi plastikiniai (PET) buteliai turi b≈´ti i≈°mesti ƒØ plastiko ir pakuoƒçi≈≥ konteinerƒØ. Geriausia ‚Äì suspausti.' },
            { item: 'Perskaitytas laikra≈°tis', correctBin: 'popierius', explanation: '≈†vari makulat≈´ra ‚Äì laikra≈°ƒçiai, ≈æurnalai, kartoninƒós dƒó≈æutƒós ‚Äì visada keliauja ƒØ popieriaus konteinerƒØ.' },
            { item: 'Kavos tir≈°ƒçiai', correctBin: 'buitines', explanation: 'Organinƒós kilmƒós atliekos, tokios kaip maisto likuƒçiai, keliauja ƒØ buitini≈≥ atliek≈≥ konteinerƒØ (arba kompostƒÖ, jei turite).' },
            { item: 'Metalinƒó skardinƒó nuo konserv≈≥', correctBin: 'plastikas', explanation: 'Metalo pakuotƒós (skardinƒós, dangteliai) metamos ƒØ tƒÖ patƒØ konteinerƒØ kaip ir plastikas ‚Äì geltonƒÖjƒØ.' }
        ];

        let sortingGameActive = false;
        let currentSortingQuestionIndex = 0;
        let sortingScore = 0;
        let shuffledQuestions = [];
        let originalSortingAction = null;
        let sortingDayIndex = null;
        let sortingSlotKey = null;
        const QUESTIONS_TO_ASK = 5; // Kiek klausim≈≥ u≈æduosime
        // --- PABAIGA: Duomenys ir kintamieji ---

        function showScreen(screenId) { dom.screens.forEach(s => s.classList.toggle('active', s.id === screenId)); }
        
             
        function closeSidebar() {
            dom.actionsSidebar.classList.remove('visible');
            dom.sidebarOverlay.classList.remove('visible');
        }

                
        function showInfoModal(title, content) {
            // Nustatome modalinio lango turinƒØ
            dom.modalTitle.textContent = title;
            dom.modalList.innerHTML = `<p style="white-space: pre-wrap; line-height: 1.5;">${content}</p>`;

            // Paslepiame nereikalingus mygtukus (jei jie buvo matomi anksƒçiau)
            dom.modal.querySelector('#modal-confirm-btn').style.display = 'none';

            // Parodome modalinƒØ langƒÖ
            dom.modal.classList.add('active');
        }

        // Pakeiskite visƒÖ ≈°iƒÖ funkcijƒÖ
        function initGame() {
            currentScore = STARTING_POINTS; currentDay = 0; chosenWeeklyActions = []; isWednesdayEventTriggered = false; isWednesdayEventActive = false; isGameFinished = false;
             isFirstHintShown = false; 

            // --- PAKEISTA DALIS: Dinami≈°kas weeklyPlan k≈´rimas ---
            weeklyPlan = Array.from({ length: 7 }, () => {
                const dayPlan = {};
                PLAN_SLOTS.forEach(slot => {
                    // Naudojame tƒÖ paƒçiƒÖ logikƒÖ kaip ir kitur, kad raktai atitikt≈≥
                    const key = slot.title === 'Buitis ir Skaitmena' ? 'Bendri veiksmai' : slot.title;
                    dayPlan[key] = [];
                });
                return dayPlan;
            });
            // --- PAKEITIMO PABAIGA ---

            updateScore(0);
            renderDayNav();
            renderPlanForDay(currentDay);
            showScreen('game-screen');
            updateFinishButtonState();
        }

        function updateScore(points) {
            if (typeof currentScore === 'undefined') return; // Svarbi apsauga
            currentScore += points;
            dom.scoreDisplay.textContent = `${currentScore}/${STARTING_POINTS} t≈°k.`;
            if (currentScore < 0) dom.scoreDisplay.style.color = '#d9534f';
            else if (currentScore < STARTING_POINTS / 2) dom.scoreDisplay.style.color = '#ffc94b';
            else dom.scoreDisplay.style.color = 'white';
            
            // Saugome ≈æaidimƒÖ TIK tada, kai jis yra aktyvus!
            if (isGameFinished === false) {
                saveGameState();
            }
        }
        // Pakeiskite visƒÖ ≈°iƒÖ funkcijƒÖ
        function updateFinishButtonState() {
            let isPlanComplete = true;
            for (let i = 0; i < 7; i++) {
                const dayPlan = weeklyPlan[i];
                // Patikriname visus valgi≈≥ laukelius
                const foodItemsCount = (dayPlan['Pusryƒçiai']?.length || 0) + 
                                    (dayPlan['Piet≈´s']?.length || 0) + 
                                    (dayPlan['Vakarienƒó']?.length || 0);
                if (foodItemsCount < 2) {
                    isPlanComplete = false;
                    break; 
                }
            }
            dom.finishBtn.classList.toggle('disabled', !isPlanComplete);
        }
        function renderDayNav() {
            dom.dayNav.innerHTML = '';
            WEEKDAYS.forEach((day, index) => {
                const btn = document.createElement('button');
                btn.className = 'day-btn'; btn.textContent = day;
                btn.classList.toggle('active', index === currentDay);
                btn.onclick = () => {
                    currentDay = index;
                    if (index === 2 && !isWednesdayEventTriggered) {
                        triggerWednesdayEvent();
                    }
                    renderDayNav();
                    renderPlanForDay(currentDay);
                };
                dom.dayNav.appendChild(btn);
            });
        }
        
        // Pakeiskite ≈°iƒÖ funkcijƒÖ
       // Pakeiskite ≈°iƒÖ funkcijƒÖ
        function renderPlanForDay(dayIndex, highlightItemName = null) { // Pridedame naujƒÖ parametrƒÖ
            dom.planArea.innerHTML = '';
            const dayPlan = weeklyPlan[dayIndex];
            const title = document.createElement('h2');
            title.textContent = DAY_NAMES[dayIndex];
            dom.planArea.appendChild(title);

            PLAN_SLOTS.forEach(slotInfo => {
                const slotKey = slotInfo.title === 'Buitis ir Skaitmena' ? 'Bendri veiksmai' : slotInfo.title;
                const itemsInSlot = weeklyPlan[dayIndex][slotKey] || [];
                // Perduodame highlightItemName toliau ƒØ createPlanSlot
                dom.planArea.appendChild(createPlanSlot(dayIndex, slotInfo.title, itemsInSlot, slotInfo.allowedCategories, highlightItemName));
            });

            updateFinishButtonState();
        }



        // Pridƒókite ≈°iƒÖ naujƒÖ funkcijƒÖ prie kit≈≥ JavaScript funkcij≈≥
        // Pakeiskite visƒÖ ≈°iƒÖ funkcijƒÖ
        // Pakeiskite visƒÖ ≈°iƒÖ funkcijƒÖ
        function renderActionsSidebar(categoriesToShow) {
            dom.actionsSidebar.innerHTML = ''; // I≈°valome senƒÖ turinƒØ
            let isFirstItem = true; // Stebƒósime, ar tai pirmas elementas sƒÖra≈°e

            // --- NAUJA DALIS: VIENKARTINƒñ U≈ΩUOMINA ≈†ONINƒñJE JUOSTOJE ---
            if (!isFirstHintShown) {
                const hintDiv = document.createElement('div');
                hintDiv.className = 'sidebar-hint-text';
                hintDiv.innerHTML = 'Dabar paspauskite, laikykite ir tempkite norimƒÖ veiksmƒÖ ƒØ planƒÖ!';
                dom.actionsSidebar.appendChild(hintDiv);
            }
            // --- U≈ΩUOMINOS PABAIGA ---

            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '&times; U≈ædaryti';
            closeBtn.style.cssText = 'background: #ddd; width: 100%; border: none; padding: 10px; font-weight: bold; margin-bottom: 15px; border-radius: 5px; cursor: pointer;';
            closeBtn.onclick = closeSidebar;
            dom.actionsSidebar.appendChild(closeBtn);

            categoriesToShow.forEach(categoryName => {
                const itemsInCategory = items[categoryName];
                if (!itemsInCategory) return;

                const categoryTitle = document.createElement('h3');
                categoryTitle.textContent = categoryName;
                dom.actionsSidebar.appendChild(categoryTitle);

                itemsInCategory.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'draggable-item';
                    itemDiv.draggable = true;

                    // --- NAUJA DALIS: ANIMACIJOS PRIDƒñJIMAS PIRMAJAM ELEMENTUI ---
                    if (!isFirstHintShown && isFirstItem) {
                        itemDiv.classList.add('first-item-hint');
                        isFirstItem = false; // Nustatome, kad pirmas elementas jau rastas
                        
                        // Nuimame animacijƒÖ po keli≈≥ sekund≈æi≈≥
                        setTimeout(() => {
                            itemDiv.classList.remove('first-item-hint');
                        }, 2000); // 2 sekundƒós
                    }
                    // --- ANIMACIJOS PABAIGA ---

                    if (item.isWeekly && chosenWeeklyActions.includes(item.name)) {
                        itemDiv.classList.add('disabled');
                        itemDiv.draggable = false;
                    }
                    
                    itemDiv.dataset.itemName = item.name;

                    itemDiv.innerHTML = `
                        <span class="item-name-sidebar">${item.name}</span>
                        <strong class="item-points-sidebar">${item.points > 0 ? '+' : ''}${item.points} t≈°k.</strong>
                    `;

                    itemDiv.addEventListener('dragstart', (event) => {
                        closeSidebar();
                        if (itemDiv.classList.contains('disabled')) {
                            event.preventDefault();
                            return;
                        }
                        event.dataTransfer.setData('text/plain', item.name);
                        event.dataTransfer.effectAllowed = 'move';
                    });

                    dom.actionsSidebar.appendChild(itemDiv);
                });
            });
            
            // --- NAUJA DALIS: Pa≈æymime, kad u≈æuomina buvo parodyta ---
            if (!isFirstHintShown) {
                isFirstHintShown = true;
            }
        }
       
               // Pakeiskite visƒÖ ≈°iƒÖ funkcijƒÖ
        // Pakeiskite visƒÖ ≈°iƒÖ funkcijƒÖ
        function createPlanSlot(dayIndex, slotTitle, itemsInSlot, allowedCategories, highlightItemName = null) {
            const slotDiv = document.createElement('div');
            slotDiv.className = 'plan-slot';
            slotDiv.dataset.dayIndex = dayIndex;
            slotDiv.dataset.slotName = slotTitle;

            const titleH3 = document.createElement('h3');
            titleH3.textContent = slotTitle;
            slotDiv.appendChild(titleH3);

            const contentDiv = document.createElement('div');
            contentDiv.className = 'slot-content';
            slotDiv.appendChild(contentDiv);

            titleH3.addEventListener('click', () => {
                renderActionsSidebar(allowedCategories);
                dom.actionsSidebar.classList.add('visible');
                dom.sidebarOverlay.classList.add('visible');

                
            });

            if (itemsInSlot && itemsInSlot.length > 0) {
                const list = document.createElement('ul');
                list.className = 'general-actions-list';

                itemsInSlot.forEach(item => {
                    const li = document.createElement('li');
                    const textNode = document.createElement('span');
                    textNode.innerHTML = `‚Ä¢ ${item.name} <strong>(${item.points > 0 ? '+' : ''}${item.points} t≈°k.)</strong> `;

                    const infoIcon = document.createElement('span');
                    infoIcon.className = 'item-info-icon';
                    infoIcon.textContent = '‚ìò';

                    if (item.name === highlightItemName) {
                        infoIcon.classList.add('info-icon-glow');
                        setTimeout(() => {
                            infoIcon.classList.remove('info-icon-glow');
                        }, 3000);
                    }

                    infoIcon.addEventListener('click', () => {
                        showInfoModal(item.name, item.reality || 'Papildoma informacija nepateikta.');
                    });

                    li.appendChild(textNode);
                    li.appendChild(infoIcon);
                    list.appendChild(li);
                });
                contentDiv.appendChild(list);
            } else {
                // Pakeiƒçiame pradinƒØ tekstƒÖ, kaip si≈´loma paprastame sprendime
                contentDiv.innerHTML = '<p style="color: #aaa; font-style: italic; text-align: center;">Spausk ant pavadinimo, tada tempk veiksmƒÖ ƒçia</p>';
            }

            slotDiv.addEventListener('dragover', (event) => {
                event.preventDefault();
                slotDiv.classList.add('drag-over');
            });

            slotDiv.addEventListener('drop', (event) => {
                event.preventDefault();
                slotDiv.classList.remove('drag-over');
                const itemName = event.dataTransfer.getData('text/plain');

                let droppedItem = null;
                let itemCategory = null;
                for (const category in items) {
                    const found = items[category].find(i => i.name === itemName);
                    if (found) {
                        droppedItem = found;
                        itemCategory = category;
                        break;
                    }
                }

                if (droppedItem) {
                    if (!allowedCategories.includes(itemCategory)) {
                        alert(`"${droppedItem.name}" negalima pridƒóti ƒØ "${slotTitle}" laukelƒØ.`);
                        return;
                    }

                    if (droppedItem.name === 'Kruop≈°tus r≈´≈°iavimas visƒÖ savaitƒô') {
                        startSortingMinigame(droppedItem, dayIndex, slotTitle);
                        closeSidebar();
                        return;
                    }

                    const slotKey = slotTitle === 'Buitis ir Skaitmena' ? 'Bendri veiksmai' : slotTitle;
                    if (!weeklyPlan[dayIndex][slotKey]) {
                        weeklyPlan[dayIndex][slotKey] = [];
                    }
                    weeklyPlan[dayIndex][slotKey].push(droppedItem);
                    updateScore(droppedItem.points);

                    if (droppedItem.isWeekly) {
                        chosenWeeklyActions.push(droppedItem.name);
                    }

                    renderPlanForDay(dayIndex, droppedItem.name);
                    closeSidebar();
                }
            });

            slotDiv.addEventListener('dragleave', () => {
                slotDiv.classList.remove('drag-over');
            });

            return slotDiv;
        }

        
        // Pakeiskite visƒÖ ≈°iƒÖ funkcijƒÖ
        function displayEndScreen() {
            // --- Esama logika rezultat≈≥ skaiƒçiavimui (lieka ta pati) ---
            let totalCo2e = 0;
            let totalWaterSaved = 0;
            let mostSustainableChoice = null;
            let summaryHTML = '<div style="border-top: 1px solid #eee; margin-top: 20px; padding-top: 10px;"></div>';

            const allChosenItems = [];
            weeklyPlan.forEach(dayPlan => {
                for (const slotKey in dayPlan) {
                    allChosenItems.push(...dayPlan[slotKey]);
                }
            });
            
            allChosenItems.forEach(item => {
                if (item.co2e) totalCo2e += item.co2e;
                if (item.waterSaved) totalWaterSaved += item.waterSaved;
                if (!mostSustainableChoice || (item.points > 0 && item.points > mostSustainableChoice.points)) {
                    mostSustainableChoice = item;
                }
            });

            const carKmEquivalent = Math.round(totalCo2e * 5.88);
            let infographicHTML = `
                <div style="background-color: #f0f0f0; border-radius: 8px; padding: 15px; margin-bottom: 20px; text-align: left;">
                    <h3 style="margin-top: 0; margin-bottom: 8px; color: var(--primary-color);">Savaitƒós poveikio suvestinƒó </h3>
                    
                    <div style="width: 100%; max-width: 350px; margin: 15px auto;">
                        <canvas id="resultsChart"></canvas>
                    </div>
                    
                    <ul style="list-style-type: '‚û°Ô∏è '; padding-left: 20px; margin-top: 0;">
                        <li>J≈´s≈≥ bendras CO‚ÇÇ pƒódsakas ≈°iƒÖ savaitƒô: <strong>${totalCo2e.toFixed(1)} kg</strong>.</li>
                        <li>Tai prilygsta kelionei automobiliu: <strong>${carKmEquivalent} km</strong>.</li>
                        <li>Sutaupƒóte: <strong>${Math.round(totalWaterSaved)} litr≈≥ vandens</strong>.</li>
                        ${mostSustainableChoice ? `<li>J≈´s≈≥ tvariausias pasirinkimas: <strong>"${mostSustainableChoice.name}" (+${mostSustainableChoice.points} t≈°k.)</strong>.</li>` : ''}
                    </ul>
                </div>
            `;

            weeklyPlan.forEach((dayPlan, dayIndex) => {
                const allDailyItems = [];
                for (const slotKey in dayPlan) {
                    allDailyItems.push(...dayPlan[slotKey]);
                }
                if (allDailyItems.length > 0) {
                    summaryHTML += `<h4 style="margin-top: 15px; margin-bottom: 5px; color: var(--primary-color); text-align: left;">${DAY_NAMES[dayIndex]}</h4>`;
                    const dailyItemsHTML = allDailyItems.map(item =>
                        `<li>‚Ä¢ ${item.name} <span style="font-weight: bold;">(${item.points > 0 ? '+' : ''}${item.points} t≈°k.)</span></li>`
                    ).join('');
                    summaryHTML += `<ul style="list-style-type: none; padding-left: 0; text-align: left; font-size: 0.9em; margin: 0;">${dailyItemsHTML}</ul>`;
                }
            });

            if (currentScore >= 0) {
                dom.endTitle.textContent = "Savaitƒós rezultatai";
                dom.endMessage.innerHTML = `Sveikiname! ü•≥ Sƒókmingai suplanavote savaitƒô! J≈´s≈≥ likutis: <span style="color: var(--primary-color); font-weight: bold;">${currentScore} t≈°k.</span>` + infographicHTML;
            } else {
                dom.endTitle.textContent = "Savaitƒós rezultatai";
                dom.endMessage.innerHTML = `≈†ƒØkart nepavyko... Vir≈°ijote biud≈æetƒÖ ${-currentScore} ta≈°kais. J≈´s≈≥ likutis: <span style="color: var(--danger-color); font-weight: bold;">${currentScore} t≈°k.</span>` + infographicHTML;
            }

            // === NAUJA DALIS: GRAFIKO K≈™RIMAS ===

          
            // 1. Suruo≈°iame duomenis grafikui (CO‚ÇÇ pƒódsakas kiekvienai dienai)
            const dailyCo2Data = weeklyPlan.map(dayPlan => {
                let dailyTotal = 0;
                for (const slotKey in dayPlan) {
                    dayPlan[slotKey].forEach(item => {
                        if (item.co2e) {
                            dailyTotal += item.co2e;
                        }
                    });
                }
                return dailyTotal;
            });

            // 2. Sunaikiname senƒÖ grafikƒÖ, jei toks egzistuoja
            if (myChart) {
                myChart.destroy();
            }

            // 3. Kuriame naujƒÖ grafikƒÖ su teisinga strukt≈´ra
            const ctx = document.getElementById('resultsChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: DAY_NAMES,
                    datasets: [{
                        label: 'CO‚ÇÇ Pƒódsakas (kg)',
                        data: dailyCo2Data,
                        backgroundColor: dailyCo2Data.map(value => value > 0 ? 'rgba(217, 83, 79, 0.6)' : 'rgba(44, 110, 73, 0.6)'),
                        borderColor: dailyCo2Data.map(value => value > 0 ? 'rgba(217, 83, 79, 1)' : 'rgba(44, 110, 73, 1)'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuad',
                    },
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Savaitƒós CO‚ÇÇ pƒódsako ap≈ævalga'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'CO‚ÇÇe (kg)'
                            }
                        }
                    }
                }
            });
            
             // Pridedame detal≈≥ dienos planƒÖ po visko
            dom.endMessage.insertAdjacentHTML('beforeend', summaryHTML);
            
            showScreen('end-screen');
            
            // 2. Then, we create the chart with a tiny delay
            setTimeout(() => {
                // All of the chart creation logic is now inside here
                const dailyCo2Data = weeklyPlan.map(dayPlan => {
                    let dailyTotal = 0;
                    for (const slotKey in dayPlan) {
                        dayPlan[slotKey].forEach(item => {
                            if (item.co2e) {
                                dailyTotal += item.co2e;
                            }
                        });
                    }
                    return dailyTotal;
                });

                if (myChart) {
                    myChart.destroy();
                }

                const ctx = document.getElementById('resultsChart').getContext('2d');
                myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: DAY_NAMES,
                        datasets: [{
                            label: 'CO‚ÇÇ Pƒódsakas (kg)',
                            data: dailyCo2Data,
                            backgroundColor: dailyCo2Data.map(value => value > 0 ? 'rgba(217, 83, 79, 0.6)' : 'rgba(44, 110, 73, 0.6)'),
                            borderColor: dailyCo2Data.map(value => value > 0 ? 'rgba(217, 83, 79, 1)' : 'rgba(44, 110, 73, 1)'),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        animation: {
                            duration: 1500,
                            easing: 'easeInOutQuad',
                        },
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'Savaitƒós CO‚ÇÇ pƒódsako ap≈ævalga'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'CO‚ÇÇe (kg)'
                                }
                            }
                        }
                    }
                });
            }, 50); // 50 milliseconds is enough time for the browser to settle
        } // End of the functio
        

        if (!loadGameState()) {
            // If no game was loaded, show the start screen as normal
            showScreen('start-screen');
        }
        dom.startBtn.addEventListener('click', () => {
            localStorage.removeItem(STORAGE_KEY); // Clear any old game
            initGame();
        });
        dom.rulesBtn.addEventListener('click', () => alert("≈Ωaidimo tikslas:\n\n1. Suplanuokite visƒÖ savaitƒô, priimdami sprendimus kiekvienai dienai.\n2. Startuojate su 100 eko-ta≈°k≈≥.\n3. Stenkitƒós nevir≈°yti biud≈æeto!\n\nLaimi tas, kas sukuria tvar≈≥ ir smag≈≥ savaitƒós planƒÖ."));
        
        dom.finishBtn.addEventListener('click', () => {
            if (dom.finishBtn.classList.contains('disabled')) {
                alert('Ruo≈°iatƒós badauti?');
                return;
            }
            isGameFinished = true; // Set the flag
            saveGameState();       // Save the final state
            displayEndScreen();    // Display the results
        });

        dom.restartBtn.addEventListener('click', () => {
            localStorage.removeItem(STORAGE_KEY); // Clear the finished game
            showScreen('start-screen'); 
            
        });

        dom.sidebarOverlay.addEventListener('click', closeSidebar);

            
        function closeModal() {
            if (isWednesdayEventActive) {
                applyWednesdayDefault();
            }
            dom.modal.classList.remove('active');
        }

        dom.modalCloseBtn.addEventListener('click', closeModal);
        dom.modal.addEventListener('click', (e) => { 
            if (e.target === dom.modal) {
                closeModal();
            }
        });
        
        function triggerWednesdayEvent() {
            isWednesdayEventActive = true; 
            isWednesdayEventTriggered = true; // Pa≈æymime, kad ƒØvykis ƒØvyko
            dom.modalTitle.textContent = 'Nelaimƒó treƒçiadienƒØ!';
            dom.modalList.innerHTML = `
                <p style="text-align: left; margin-bottom: 20px;">Tavo i≈°manusis telefonas ƒØkrito ƒØ klozetƒÖ dar nespƒójus nuleisti to, kas jame pl≈´duriuoja (dienƒÖ prie≈° suvalgei kebabƒÖ, kuris labai susipyko su tavo skrand≈æiu). KƒÖ darai?</p>
            `;

            const choices = [
                { text: 'Perki naujƒÖ i≈°man≈≥jƒØ telefonƒÖ', points: -75, reality: 'Realybƒó: ~60-90 kg CO‚ÇÇe. Apie 80% telefono pƒódsako atsiranda gamybos metu dƒól ret≈≥j≈≥ metal≈≥ kasybos, energijai imli≈≥ proces≈≥ ir transportavimo. Kiekvienas naujas telefonas yra did≈æiulƒó na≈°ta planetai.', penalty: true },
                { text: 'Perki naudotƒÖ telefonƒÖ', points: -10, reality: 'Realybƒó: Poveikis artimas nuliui. J≈´s neinicijuojate naujos gamybos, o pratƒôsiate jau pagaminto produkto gyvavimo ciklƒÖ. PƒódsakƒÖ sudaro tik transportavimas. Tai vienas efektyviausi≈≥ b≈´d≈≥ ma≈æinti elektronikos atliekas ir resurs≈≥ naudojimƒÖ.', penalty: true },
                { text: 'Greitai bandai i≈°gelbƒóti telefonƒÖ', points: 15, reality: 'Realybƒó: J≈´s ‚Äûsutaupote‚Äú visas emisijas ir resursus, kurie b≈´t≈≥ buvƒô panaudoti naujo daikto gamybai.', penalty: false }
            ];

            choices.forEach(choice => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'modal-item';
                itemDiv.style.flexDirection = 'column';
                itemDiv.style.alignItems = 'flex-start';
                itemDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; width: 100%;">
                        <span>${choice.text}</span>
                        <strong style="white-space: nowrap;">${choice.points > 0 ? '+' : ''}${choice.points} t≈°k.</strong>
                    </div>
                    <small style="margin-top: 5px; color: #555;">${choice.reality}</small>
                `;
                itemDiv.onclick = () => {
                    isWednesdayEventActive = false;
                    const eventItem = { name: choice.text, points: choice.points, reality: choice.reality };
                    weeklyPlan[2]['Bendri veiksmai'].push(eventItem);
                    updateScore(choice.points);

                    if (choice.penalty) {
                        const penaltyItem = { name: 'Seno telefono pavertimas elektronine atlieka', points: -5, reality: 'I≈°metus telefonƒÖ ƒØ bendrƒÖ konteinerƒØ, jis tampa pavojinga atlieka. Netinkamai tvarkoma elektronika ƒØ aplinkƒÖ i≈°skiria toksi≈°kus metalus (≈°vinƒÖ, gyvsidabrƒØ), kurie kenkia ekosistemoms ir ≈æmoni≈≥ sveikatai.' };
                        weeklyPlan[2]['Bendri veiksmai'].push(penaltyItem);
                        updateScore(-5);
                    }
                    
                    renderPlanForDay(2);
                    dom.modal.classList.remove('active');
                };
                dom.modalList.appendChild(itemDiv);
            });

            dom.modal.classList.add('active');
        }

        function applyWednesdayDefault() {
            isWednesdayEventActive = false;
            const defaultChoice = { 
                name: 'Gyvenimas be i≈°maniojo telefono', 
                points: 20,
                reality: 'J≈´s visi≈°kai i≈°vengiate did≈æiausio asmeninƒós elektronikos poveikio ‚Äì gamybos. Tai prilygsta (-75 t≈°k.) pƒódsako eliminavimui kas kelerius metus. J≈´s taip pat drasti≈°kai suma≈æinate savo skaitmeninƒØ pƒódsakƒÖ ir energijos suvartojimƒÖ. Realybƒóje, 2025 metais, tai yra did≈æiulis i≈°≈°≈´kis: prarandama prieiga prie mobiliosios bankininkystƒós, ≈æemƒólapi≈≥, momentini≈≥ ≈æinuƒçi≈≥ programƒóli≈≥, ‚ÄûBolt‚Äú ar ‚ÄûCityBee‚Äú paslaug≈≥.'
            };
            weeklyPlan[2]['Bendri veiksmai'].push(defaultChoice);
            updateScore(defaultChoice.points);
            renderPlanForDay(2);
        }

// --- PRAD≈ΩIA: Funkcijos r≈´≈°iavimo mini ≈æaidimui ---
        
        function startSortingMinigame(item, dayIdx, slotTitle) {
            sortingGameActive = true;
            originalSortingAction = item;
            sortingDayIndex = dayIdx;
            // Koreguojame rakto pavadinimƒÖ, kad atitikt≈≥ planƒÖ
            sortingSlotKey = slotTitle === 'Buitis ir Skaitmena' ? 'Bendri veiksmai' : slotTitle;

            currentSortingQuestionIndex = 0;
            sortingScore = 0;

            // Sumai≈°ome klausimus, kad kaskart b≈´t≈≥ vis kitokie
            shuffledQuestions = [...sortingQuestions].sort(() => 0.5 - Math.random()).slice(0, QUESTIONS_TO_ASK);

            dom.sortingModal.classList.add('active');
            displayNextSortingQuestion();
        }

        function displayNextSortingQuestion() {
            dom.sortingFeedback.textContent = '';
            dom.sortingExplanation.style.display = 'none';

            if (currentSortingQuestionIndex >= shuffledQuestions.length) {
                endSortingMinigame();
                return;
            }

            const question = shuffledQuestions[currentSortingQuestionIndex];
            dom.sortingProgress.textContent = `Klausimas ${currentSortingQuestionIndex + 1} i≈° ${QUESTIONS_TO_ASK}`;
            dom.sortingQuestion.textContent = `Kur mesti: ‚Äû${question.item}‚Äú?`;
            
            dom.sortingBins.innerHTML = ''; // I≈°valome senus mygtukus
            const bins = {
                plastikas: 'PlastikƒÖ ir pakuotes',
                popierius: 'Popieri≈≥',
                stiklas: 'StiklƒÖ',
                buitines: 'Buitines atliekas',
                pavojingos: 'Pavojingas atliekas'
            };

            for (const binKey in bins) {
                const button = document.createElement('button');
                button.textContent = bins[binKey];
                button.className = `bin-btn ${binKey}`;
                button.onclick = () => checkSortingAnswer(binKey, question.correctBin, question.explanation);
                dom.sortingBins.appendChild(button);
            }
        }

        function checkSortingAnswer(chosenBin, correctBin, explanation) {
            if (chosenBin === correctBin) {
                sortingScore++;
                dom.sortingFeedback.textContent = 'Teisingai! ‚úÖ';
                dom.sortingFeedback.className = 'correct';
            } else {
                dom.sortingFeedback.textContent = 'Neteisingai... ‚ùå';
                dom.sortingFeedback.className = 'incorrect';
            }

            // Parodome paai≈°kinimƒÖ
            dom.sortingExplanation.textContent = explanation;
            dom.sortingExplanation.style.display = 'block';

            // U≈æblokuojame mygtukus, kad neb≈´t≈≥ galima paspausti kelis kartus
            dom.sortingBins.querySelectorAll('button').forEach(btn => btn.disabled = true);

            // Po trumpos pauzƒós pereiname prie kito klausimo
            const nextButton = document.createElement('button');
            nextButton.textContent = 'Kitas klausimas ‚Üí';
            // Panaudojame esamus mygtuk≈≥ stilius
            nextButton.className = 'btn btn-primary'; 
            nextButton.style.width = '100%';
            nextButton.style.marginTop = '10px';

            nextButton.onclick = () => {
                currentSortingQuestionIndex++;
                displayNextSortingQuestion();
            };

            // I≈°valome konteineri≈≥ mygtukus ir ƒØdedame naujƒÖjƒØ mygtukƒÖ
            dom.sortingBins.innerHTML = '';
            dom.sortingBins.style.gridTemplateColumns = '1fr 1fr'; // Atstatome dviej≈≥ stulpeli≈≥ i≈°dƒóstymƒÖ
            dom.sortingBins.appendChild(nextButton);
        }

        function endSortingMinigame() {
            sortingGameActive = false;
            let finalPoints = 0;
            let resultText = '';

            // Skaiƒçiuojame ta≈°kus pagal teising≈≥ atsakym≈≥ skaiƒçi≈≥
            if (sortingScore === QUESTIONS_TO_ASK) {
                finalPoints = originalSortingAction.points; // 5 t≈°k.
                resultText = 'be klaid≈≥';
            } else if (sortingScore >= QUESTIONS_TO_ASK - 2) {
                finalPoints = Math.round(originalSortingAction.points / 2); // 3 t≈°k.
                resultText = 'su keliomis klaidomis';
            } else {
                finalPoints = 0; // 0 t≈°k.
                resultText = 'reikia pasimokyti';
            }

            const resultItem = {
                name: `R≈´≈°iavimas (${sortingScore}/${QUESTIONS_TO_ASK} teisingai, ${resultText})`,
                points: finalPoints,
                reality: `J≈´s atsakƒóte teisingai ƒØ ${sortingScore} i≈° ${QUESTIONS_TO_ASK} klausim≈≥ ir gavote ${finalPoints} ta≈°k≈≥.\n---\n${originalSortingAction.reality}`
            };
            
            // ƒÆra≈°ome rezultatƒÖ ƒØ savaitƒós planƒÖ
            if (!weeklyPlan[sortingDayIndex][sortingSlotKey]) {
                weeklyPlan[sortingDayIndex][sortingSlotKey] = [];
            }
            weeklyPlan[sortingDayIndex][sortingSlotKey].push(resultItem);
            
            // Pridedame prie savaitini≈≥ veiksm≈≥, kad neb≈´t≈≥ galima pasirinkti dar kartƒÖ
            if (originalSortingAction.isWeekly) {
                 chosenWeeklyActions.push(originalSortingAction.name);
            }

            updateScore(finalPoints);
            renderPlanForDay(sortingDayIndex);
            
            dom.sortingModal.classList.remove('active');
            alert(`≈Ωaidimas baigtas! Teisingi atsakymai: ${sortingScore}/${QUESTIONS_TO_ASK}. GAUTI TA≈†KAI: ${finalPoints}.`);
        }
        // --- PABAIGA: Funkcijos r≈´≈°iavimo mini ≈æaidimui ---
    });
    </script>
</body>
</html>
